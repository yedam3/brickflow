"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[675],{8400:function(t,e,a){a.r(e),a.d(e,{default:function(){return nt}});var o=a(5432),r=a(5122),l=a(641);const d={class:"text-end mb-3"},i={class:"ag-theme-alpine align-content-center"},n={class:"text-center mt-3"};function s(t,e,a,o,s,c){const m=(0,l.g2)("CModalHeader"),_=r.A,u=(0,l.g2)("AgGridVue"),h=(0,l.g2)("CModalBody"),p=(0,l.g2)("CButton"),f=(0,l.g2)("CModalFooter"),w=(0,l.g2)("CModal");return(0,l.uX)(),(0,l.Wv)(w,{visible:a.visible,onClose:c.close,backdrop:"static",alignment:"center",size:"xl",style:{"min-width":"1000px"}},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.RG)(t.$slots,"header",{},(()=>[e[0]||(e[0]=(0,l.eW)("재고 품목"))]),!0)])),_:3}),(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.bF)(_,{label:"자동계산",severity:"success",size:"large",onClick:c.autoHold},null,8,["onClick"])]),(0,l.Lk)("div",i,[(0,l.bF)(u,{style:{width:"100%",height:"100%"},class:"ag-theme-alpine",columnDefs:s.columnDefs,rowData:s.rowData,gridOptions:s.gridOptions},null,8,["columnDefs","rowData","gridOptions"])]),(0,l.Lk)("div",n,[(0,l.bF)(_,{label:"자재 확보",severity:"success",size:"large",onClick:c.matSecure},null,8,["onClick"])])])),_:1}),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.RG)(t.$slots,"footer",{},(()=>[(0,l.bF)(p,{color:"secondary",onClick:c.close},{default:(0,l.k6)((()=>e[1]||(e[1]=[(0,l.eW)("닫기")]))),_:1},8,["onClick"])]),!0)])),_:3})])),_:3},8,["visible","onClose"])}a(4114),a(8111),a(116),a(1701);var c=a(7654),m=a(4335),_=a(8465),u=a.n(_),h={name:"MatStockModal",components:{AgGridVue:c.b},props:{visible:{type:Boolean,required:!0},prod_code:{type:String,required:!1},mat_code:{type:String,required:!1},mat_list:{type:Array,required:!1},mat_req_qty:{type:Number,required:!1},mat_temp_data:{type:Array,required:!1}},watch:{visible(t){t&&this.matStockList()},rowData:{handler(t){},deep:!0}},data(){return{rowData:[],original_rowData:[],mat_data:[],columnDefs:[{field:"mat_LOT",headerName:"LOT번호",flex:1},{field:"mat_code",headerName:"자재코드",flex:1},{field:"mat_name",headerName:"자재명",flex:1},{field:"store_date",headerName:"입고일자",flex:1},{field:"available_qty",headerName:"자재출고 가능 수량",flex:2},{field:"mat_hold_qty",headerName:"자재출고 수량",editable:!0,flex:2}],gridOptions:{domLayout:"autoHeight",suppressCellFocus:!0,pagination:!0,paginationPageSize:5,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1,cellStyle:{textAlign:"center"}}}}},mounted(){this.matStockList()},methods:{close(){this.$emit("close")},async matStockList(){this.rowData=[];const t=await m.A.get("/api/work/order/matQty",{params:{prod_code:this.prod_code,mat_code:this.mat_code}}).catch((t=>{console.error(t)}));let e=t.data;for(let a of e)this.rowData.push({prod_code:this.prod_code,mat_LOT:a.mat_LOT,mat_code:a.mat_code,mat_name:a.mat_name,store_date:a.store_date,available_qty:parseInt(a.available_qty),mat_hold_qty:0});this.setMatHoldData()},updateAvailableQty(t){},autoHold(){let t=this.mat_req_qty;for(let e of this.rowData){const a=parseInt(e.available_qty);if(t<=0)break;const o=Math.min(a,t);e.mat_hold_qty=o,t-=o}this.rowData=[...this.rowData]},matSecure(){this.mat_data=[];let t=0;for(let e of this.rowData){if(t+=parseInt(e.mat_hold_qty),""!=e.mat_hold_qty&&parseInt(e.mat_hold_qty)>0){if(parseInt(e.available_qty)<parseInt(e.mat_hold_qty))return void u().fire({title:"실패",text:"자재 출고 가능수량보다 자재출고 수량이 더 많습니다.",icon:"error",confirmButtonText:"확인"});this.mat_data.push({prod_code:this.prod_code,mat_code:e.mat_code,mat_LOT:e.mat_LOT,mat_hold_qty:e.mat_hold_qty})}console.log(this.mat_data)}this.mat_req_qty>t?u().fire({title:"실패",text:"자재 최소 요구량이 충족하지 않습니다.",icon:"error",confirmButtonText:"확인"}):(this.$emit("matHoldData",this.mat_data),this.close())},onRowClicked(){},setMatHoldData(){this.mat_list&&this.mat_list.length>0&&(this.rowData=this.rowData.map((t=>{const e=this.mat_list.find((e=>e.mat_LOT.toLowerCase()==t.mat_LOT.toLowerCase()&&e.mat_code.toLowerCase()==t.mat_code.toLowerCase()));return e?{...t,mat_hold_qty:e.hold_quantity}:t}))),this.mat_temp_data&&this.mat_temp_data.length>0&&(this.rowData=this.rowData.map((t=>{const e=this.mat_temp_data.find((e=>e.prod_code.toLowerCase()==t.prod_code.toLowerCase()&&e.mat_LOT.toLowerCase()==t.mat_LOT.toLowerCase()&&e.mat_code.toLowerCase()==t.mat_code.toLowerCase()));return e?{...t,mat_hold_qty:e.hold_quantity}:t}))),this.original_rowData=[...this.rowData];for(let e of this.mat_temp_data){let t=this.rowData.findIndex((t=>t.mat_code==e.mat_code&&t.mat_LOT==e.mat_LOT));-1!==t&&(this.rowData[t].available_qty=parseInt(this.rowData[t].available_qty)-parseInt(e.hold_quantity))}let t=[];for(let e of this.rowData){let a=!1;if(this.mat_temp_data&&this.mat_temp_data.length>0)for(let o of this.mat_temp_data)if(e.mat_LOT===o.mat_LOT&&e.prod_code===o.prod_code){t.push(e),a=!0;break}!a&&e.available_qty>0&&t.push(e)}this.rowData=[...t]}}},p=a(6262);const f=(0,p.A)(h,[["render",s],["__scopeId","data-v-3b311d2c"]]);var w=f,D=a(3751);const y={class:"ag-theme-alpine",style:{height:"400px",width:"100%"}},k={class:"d-flex justify-content-center me-5"},g={class:"input-group mb-3 w-50"};function b(t,e,a,o,r,d){const i=(0,l.g2)("CModalHeader"),n=(0,l.g2)("AgGridVue"),s=(0,l.g2)("CModalBody"),c=(0,l.g2)("CButton"),m=(0,l.g2)("CModalFooter"),_=(0,l.g2)("CModal");return(0,l.uX)(),(0,l.Wv)(_,{visible:a.visible,onClose:d.close,backdrop:"static",alignment:"center",size:"xl",style:{"min-width":"1000px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.RG)(t.$slots,"header",{},(()=>[e[4]||(e[4]=(0,l.eW)("생산지시 목록"))]),!0)])),_:3}),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",y,[(0,l.Lk)("div",k,[(0,l.Lk)("div",g,[(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=t=>r.searchType=t),"aria-label":"Default select example"},e[5]||(e[5]=[(0,l.Lk)("option",{value:"product_order_name",selected:""},"지시명",-1),(0,l.Lk)("option",{value:"product_order_code"},"지시 코드",-1),(0,l.Lk)("option",{value:"prod_name"},"제품명",-1)]),512),[[D.u1,r.searchType]]),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>r.searchText=t),placeholder:"검색어 입력",onKeydown:e[2]||(e[2]=(0,D.jR)(((...t)=>d.searchProudctOrder&&d.searchProudctOrder(...t)),["enter"])),class:"form-control w-50",style:{width:"30%"}},null,544),[[D.Jo,r.searchText]]),(0,l.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>d.searchProudctOrder&&d.searchProudctOrder(...t)),class:"btn btn-primary"},e[6]||(e[6]=[(0,l.Lk)("i",{class:"pi pi-search"},null,-1)]))])]),(0,l.bF)(n,{style:{width:"100%",height:"100%"},class:"ag-theme-alpine",columnDefs:r.columnDefs,rowData:r.rowData,gridOptions:r.gridOptions,onRowClicked:d.onRowClicked},null,8,["columnDefs","rowData","gridOptions","onRowClicked"])])])),_:1}),(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.RG)(t.$slots,"footer",{},(()=>[(0,l.bF)(c,{color:"secondary",onClick:d.close},{default:(0,l.k6)((()=>e[7]||(e[7]=[(0,l.eW)("닫기")]))),_:1},8,["onClick"])]),!0)])),_:3})])),_:3},8,["visible","onClose"])}var x={name:"PlanOrderModal",components:{AgGridVue:c.b},props:{visible:{type:Boolean,required:!0}},watch:{visible(t){t&&this.planOrderList()}},data(){return{rowData:[],searchType:"product_order_name",searchText:"",columnDefs:[{field:"product_order_code",headerName:"생산지시코드",flex:1},{field:"product_order_name",headerName:"생산지시명",flex:2},{field:"start_date",headerName:"시작일",flex:1},{field:"end_date",headerName:"종료일",flex:1},{field:"prod_name",headerName:"제품명",flex:3},{field:"finish_status",headerName:"상태",flex:1,valueFormatter:t=>"WS1"===t.value?"지시 등록":"WS2"===t.value?"생산중":"WS3"===t.value?"생산 완료":"WS4"==t.value?"폐기 처분":void 0,cellStyle:t=>"WS1"===t.value?{textAlign:"center",fontWeight:"bold",color:"#6c757d"}:"WS2"==t.value?{textAlign:"center",fontWeight:"bold",color:"#fd7e14"}:"WS3"==t.value||"WS4"==t.value?{textAlign:"center",fontWeight:"bold",color:"#28a745"}:void 0}],gridOptions:{domLayout:"autoHeight",suppressCellFocus:!0,pagination:!0,paginationPageSize:5,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1,cellStyle:{textAlign:"center"}}}}},mounted(){this.planOrderList()},methods:{close(){this.$emit("close")},planOrderList(){m.A.get("/api/work/order/list").then((t=>{this.rowData=t.data})).catch((t=>{console.error(t)}))},async searchProudctOrder(){await m.A.get("/api/work/order/list",{params:{type:this.searchType,keyword:this.searchText}}).then((t=>{this.rowData=t.data})).catch((t=>console.error(t)))},onRowClicked(t){"WS3"!==t.data.finish_status?"WS4"!==t.data.finish_status?(this.$emit("selectPlanOrder",t.data),this.close()):u().fire({title:"실패",text:"폐기된 지시입니다.",icon:"error",confirmButtonText:"확인"}):u().fire({title:"실패",text:"이미 생산이 완료된 지시입니다.",icon:"error",confirmButtonText:"확인"})}}};const L=(0,p.A)(x,[["render",b],["__scopeId","data-v-47657840"]]);var v=L,C=a(825),q=a(3889),O=a(6704),T=a(109),S=a(8235);const P={class:"card border-0",style:{height:"calc(50vh - 5rem)"}},A={class:"d-flex flex-wrap justify-content-end gap-2 text-end mt-3 mb-4"},M={class:"mb-3"},F={class:"row mb-4"},R={class:"col-4"},B={class:"col-4"},V={class:"col-4"},I={class:"row mb-4"},N={class:"col-4"},H={class:"col-4"},W={class:"row mb-4"},z={class:"col-4"},$={class:"col-4"},U={class:"col-4"},G={class:"row"},Q={class:"col"},X={class:"card border-0",style:{height:"calc(50vh - 5rem)"}},j={class:"ag-wrapper"},E={class:"col"},K={class:"card border-0",style:{height:"calc(50vh - 5rem)"}},J={class:"ag-wrapper"};function Y(t,e,a,d,i,n){const s=r.A,c=S.A,m=T.A,_=O.A,u=q.A,h=(0,l.g2)("ag-grid-vue"),p=C.A,f=v,D=w,y=o.A;return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",P,[e[20]||(e[20]=(0,l.Lk)("h3",null,"생산 지시 관리",-1)),e[21]||(e[21]=(0,l.Lk)("div",{class:"heading-with-line"},[(0,l.Lk)("h5",{class:"m-0 me-3"},"등록 | 수정 | 삭제")],-1)),(0,l.Lk)("div",A,[(0,l.bF)(s,{label:"계획목록",severity:"success",class:"",onClick:n.planList},null,8,["onClick"]),(0,l.bF)(s,{label:"지시목록",severity:"info",class:"",onClick:n.planOrderList},null,8,["onClick"]),i.editMode?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(s,{key:0,label:"등록",severity:"help",class:"",onClick:n.addPlanOrder},null,8,["onClick"])),i.editMode?((0,l.uX)(),(0,l.Wv)(s,{key:1,label:"수정",severity:"danger",class:"",onClick:n.updateProductOrder},null,8,["onClick"])):(0,l.Q3)("",!0),i.editMode?((0,l.uX)(),(0,l.Wv)(s,{key:2,label:"삭제",severity:"danger",class:"",onClick:n.deleteProductOrder},null,8,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(s,{label:"초기화",severity:"danger",class:"",onClick:n.clearForm},null,8,["onClick"])]),(0,l.Lk)("div",M,[(0,l.Lk)("div",F,[(0,l.Lk)("div",R,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[12]||(e[12]=[(0,l.eW)(" 생산 지시 코드 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.product_order_code,"onUpdate:modelValue":e[0]||(e[0]=t=>i.formData.product_order_code=t),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",B,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[13]||(e[13]=[(0,l.eW)(" 계획 코드 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.plan_code,"onUpdate:modelValue":e[1]||(e[1]=t=>i.formData.plan_code=t),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",V,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[14]||(e[14]=[(0,l.eW)(" 계획명 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.plan_name,"onUpdate:modelValue":e[2]||(e[2]=t=>i.formData.plan_name=t),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})])]),(0,l.Lk)("div",I,[(0,l.Lk)("div",N,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[15]||(e[15]=[(0,l.eW)(" 담당자 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.employee_name,"onUpdate:modelValue":e[3]||(e[3]=t=>i.formData.employee_name=t),size:"large",placeholder:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",H,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[16]||(e[16]=[(0,l.eW)(" 생산 지시명 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.product_order_name,"onUpdate:modelValue":e[4]||(e[4]=t=>i.formData.product_order_name=t),size:"large",placeholder:"(입력)"},null,8,["modelValue"])])),_:1})])]),(0,l.Lk)("div",W,[(0,l.Lk)("div",z,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[17]||(e[17]=[(0,l.eW)(" 시작일자 ")]))),_:1}),(0,l.bF)(u,{modelValue:i.formData.start_date,"onUpdate:modelValue":e[5]||(e[5]=t=>i.formData.start_date=t),size:"large",dateFormat:"yy/mm/dd",placeholder:"(입력)",showIcon:"",iconDisplay:"input"},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",$,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[18]||(e[18]=[(0,l.eW)(" 종료일자 ")]))),_:1}),(0,l.bF)(u,{modelValue:i.formData.end_date,"onUpdate:modelValue":e[6]||(e[6]=t=>i.formData.end_date=t),size:"large",dateFormat:"yy/mm/dd",placeholder:"(입력)",showIcon:"",iconDisplay:"input"},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",U,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>e[19]||(e[19]=[(0,l.eW)(" 비고 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.note,"onUpdate:modelValue":e[7]||(e[7]=t=>i.formData.note=t),size:"large",placeholder:""},null,8,["modelValue"])])),_:1})])])])]),(0,l.Lk)("div",G,[(0,l.Lk)("div",Q,[(0,l.Lk)("div",X,[e[22]||(e[22]=(0,l.Lk)("div",{class:"heading-with-line mb-3"},[(0,l.Lk)("h5",{class:"m-0 me-3"},"생산 제품 목록")],-1)),e[23]||(e[23]=(0,l.Lk)("div",{class:"row justify-content-end mb-3"},[(0,l.Lk)("div",{class:"col"})],-1)),(0,l.Lk)("div",j,[(0,l.bF)(h,{ref:"mainGrid",class:"ag-theme-alpine custom-grid-theme",columnDefs:i.prodListDefs,rowData:i.rowData,gridOptions:i.prodOptions,onCellClicked:n.prodCellClicked,onCellValueChanged:n.onProdValueChanged,context:{componentParent:this}},null,8,["columnDefs","rowData","gridOptions","onCellClicked","onCellValueChanged"])])])]),(0,l.Lk)("div",E,[(0,l.Lk)("div",K,[e[24]||(e[24]=(0,l.Lk)("div",{class:"heading-with-line mb-3"},[(0,l.Lk)("h5",{class:"me-3"},"자재 홀드")],-1)),(0,l.Lk)("div",J,[(0,l.bF)(h,{class:"ag-theme-alpine custom-grid-theme",columnDefs:i.matHoldListDefs,rowData:i.secondRowData,gridOptions:i.gridOptions,onRowClicked:n.matRowClicked},null,8,["columnDefs","rowData","gridOptions","onRowClicked"])])])])]),(0,l.bF)(p,{visible:i.showPlanModal,onClose:e[8]||(e[8]=t=>i.showPlanModal=!1),onSelectPlan:n.planSelected},null,8,["visible","onSelectPlan"]),(0,l.bF)(f,{visible:i.showPlanOrderModal,onClose:e[9]||(e[9]=t=>i.showPlanOrderModal=!1),onSelectPlanOrder:n.planOrderSelected},null,8,["visible","onSelectPlanOrder"]),(0,l.bF)(D,{visible:i.showMatStockModal,onClose:e[10]||(e[10]=t=>i.showMatStockModal=!1),prod_code:i.selectProd_code,mat_code:i.selectMat_code,mat_list:i.selectMat_list,mat_req_qty:i.selectMat_req_qty,mat_temp_data:i.matTempHoldDataList,onMatHoldData:n.matData},null,8,["visible","prod_code","mat_code","mat_list","mat_req_qty","mat_temp_data","onMatHoldData"]),(0,l.bF)(y,{visible:i.showProdModal,onClose:e[11]||(e[11]=t=>i.showProdModal=!1),onSelectProd:n.prodSelected},null,8,["visible","onSelectProd"])],64)}a(2489);var Z=a(4783),tt=a(33);const et={class:"custom-header"};function at(t,e,a,o,r,d){return(0,l.uX)(),(0,l.CE)("div",et,[(0,l.Lk)("span",null,(0,tt.v_)(a.params.displayName),1),(0,l.Lk)("button",{class:"btn btn-sm btn-success text-white",onClick:e[0]||(e[0]=(...t)=>d.onClick&&d.onClick(...t))},"추가")])}var ot={props:["params"],methods:{onClick(){if("editRow"===this.params.column.colId){const t=this.params.context?.componentParent;if(console.log(t?.formData?.plan_code),t?.formData?.plan_code&&""!==t.formData.plan_code)return void u().fire({title:"실패",text:"생산 계획으로 가져온 데이터는 추가가 불가능합니다.",icon:"error",confirmButtonText:"확인"});const e={prod_code:"",prod_name:"",plan_quantity:"",priority:"",order_quantity:""};this.params.context.componentParent.addNewRow(e),console.log("행 추가됨:",e)}}}};const rt=(0,p.A)(ot,[["render",at],["__scopeId","data-v-37b4ee0a"]]);var lt=rt,dt={components:{AgGridVue:c.b,PlanModal:C.A,PlanOrderModal:v,MatStock:w,ProdModal:o.A},data(){return{showPlanModal:!1,showPlanOrderModal:!1,showMatStockModal:!1,showProdModal:!1,selectProd_code:null,selectMat_code:null,selectMat_list:null,selectMat_req_qty:null,selectedProdIndex:null,selectedSecondIndex:null,editMode:!1,matTempHoldDataList:[],matHoldDataList:[],formData:{product_order_code:"",employee_code:(0,Z.k)().id,employee_name:(0,Z.k)().empName,product_order_name:"",plan_code:"",plan_name:"",start_date:"",end_date:"",note:""},rowData:[],secondRowData:[],prodListDefs:[{checkboxSelection:!0,width:50},{field:"prod_code",headerName:"제품코드",flex:1.5,cellStyle:t=>t.data.prod_code?{textAlign:"center"}:{textAlign:"center",backgroundColor:"#d9f2ff !important"}},{field:"prod_name",headerName:"제품명",flex:2.5,cellStyle:t=>t.data.prod_code?{textAlign:"center"}:{textAlign:"center",backgroundColor:"#d9f2ff !important"}},{field:"plan_quantity",headerName:"주문수량",flex:1.5,cellStyle:{textAlign:"center"}},{field:"priority",headerName:"우선순위",flex:1.5,cellStyle:{textAlign:"center"}},{field:"order_quantity",headerName:"지시량",flex:1.5,editable:!0,cellStyle:t=>t.data.prod_code?{textAlign:"center",backgroundColor:"#d9f2ff !important"}:{textAlign:"center"}},{field:"editRow",headerName:"",flex:1,cellStyle:{textAlign:"center"},headerComponent:lt,cellRenderer:t=>'<button class="btn btn-sm btn-danger text-white" @click="deleteRow">삭제</button>',onCellClicked:t=>{if("editRow"===t.column.colId){const e=t.event.target;if("BUTTON"===e.tagName){const e=t.data;this.rowData=this.rowData.filter((t=>t!==e)),t.api.applyTransaction({remove:[t.data]}),this.nonePlanOrder()}}}}],matHoldListDefs:[{field:"prod_code",headerName:"제품코드",flex:2,cellStyle:{textAlign:"center"}},{field:"mat_code",headerName:"자재코드",flex:2,cellStyle:{textAlign:"center"}},{field:"mat_name",headerName:"자재명",flex:2.5,cellStyle:{textAlign:"center"}},{field:"req_material_quantity",headerName:"요구량",flex:1.5,cellStyle:{textAlign:"center"}},{field:"material_input_qunatity",headerName:"투입량",flex:1,cellStyle:{textAlign:"center"}}],prodOptions:{domLayout:"autoHeight",singleClickEdit:!0,suppressRowClickSelection:!0,pagination:!0,paginationPageSize:4,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1}},gridOptions:{domLayout:"autoHeight",singleClickEdit:!0,suppressRowClickSelection:!0,pagination:!0,paginationPageSize:4,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1}}}},watch(){},mounted(){this.clearForm(),this.autoOrder_Code()},methods:{prodColumnHeaderClicked(t){if("editRow"===t.column.colId){const e=t;console.log(e)}},clearForm(){this.formData={product_order_code:this.formData.product_order_code,employee_code:(0,Z.k)().id,employee_name:(0,Z.k)().empName,product_order_name:"",plan_code:"",plan_name:"",start_date:"",end_date:"",note:""},this.rowData=[{prod_code:"",prod_name:"",plan_quantity:"",priority:"",quantity:""}],this.rowData=[],this.secondRowData=[],this.matTempHoldDataList=[],this.matHoldDataList=[],this.editMode=!1},planList(){this.showPlanModal=!0},planOrderList(){this.showPlanOrderModal=!0},matStockList(){},async autoOrder_Code(){try{const t=await m.A.get("/api/work/order/orderAutoCode");this.formData.product_order_code=t.data[0].product_order_code}catch(t){console.error(t)}},async planSelected(t){this.clearForm(),this.formData.plan_code=t.plan_code,this.formData.plan_name=t.plan_name,this.formData.start_date=t.start_date,this.formData.end_date=t.end_date,await m.A.get(`/api/work/plan/planDetailList/${t.plan_code}`,{}).then((t=>{this.rowData=[];const e=t.data;let a=1;for(let o of e)this.rowData.push({prod_code:o.prod_code,prod_name:o.prod_name,plan_quantity:o.currentPlanQty,priority:a,order_quantity:o.currentPlanQty}),a++})).catch((t=>console.error(t))),await m.A.get(`/api/work/order/matReqQty/${t.plan_code}`,{}).then((t=>{this.secondRowData=[];const e=t.data;for(let a of e)this.secondRowData.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_name:a.mat_name,req_material_quantity:a.req_material_quantity,material_input_qunatity:a.material_input_qunatity})})).catch((t=>{console.error(t)})),this.rowData=[...this.rowData],this.nonePlanOrder()},async planOrderSelected(t){this.clearForm();let e=await m.A.get(`/api/work/order/productOrder/${t.product_order_code}`).catch((t=>console.error(t)));const a=e.data;this.formData.product_order_code=a.product_order_code,this.formData.product_order_name=a.product_order_name,this.formData.employee_code=a.employee_code,this.formData.plan_code=a.plan_code,this.formData.plan_name=a.plan_name,this.formData.start_date=a.start_date,this.formData.end_date=a.end_date,this.formData.note=a.note,e=await m.A.get(`/api/work/order/workDetail/${t.product_order_code}`).catch((t=>console.error(t)));const o=e.data;for(let r of o){this.rowData.push({product_order_detail_code:r.product_order_detail_code,prod_code:r.prod_code,prod_name:r.prod_name,plan_quantity:r.plan_quantity,priority:r.priority,order_quantity:r.order_quantity}),e=await m.A.get(`/api/work/order/loadMatQty/${r.product_order_detail_code}`).catch((t=>console.error(t)));const t=e.data;for(let a of t){e=await m.A.get("/api/work/order/loadMat",{params:{product_order_detail_code:r.product_order_detail_code,mat_code:a.mat_code}}).catch((t=>console.error(t)));const t=e.data;let o=0,l=[];for(let e of t){let t={prod_code:e.prod_code,mat_code:a.mat_code,mat_LOT:e.mat_LOT,mat_hold_qty:e.hold_quantity};this.matHoldDataList.push(t),l.push(t),o+=parseInt(e.hold_quantity)}this.secondRowData.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_name:a.mat_name,req_material_quantity:a.req_material_quantity,material_input_qunatity:o,mat_LOTs:l})}}this.rowData=[...this.rowData],this.secondRowData=[...this.secondRowData],console.log(this.secondRowData),this.matHoldDataList=[...this.matHoldDataList],this.editMode=!0},matRowClicked(t){this.selectProd_code=t.data.prod_code,this.selectMat_code=t.data.mat_code,this.selectMat_req_qty=t.data.req_material_quantity;let e=[];for(let a of this.matHoldDataList)a.mat_code==t.data.mat_code&&a.prod_code==t.data.prod_code&&e.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_LOT:a.mat_LOT,hold_quantity:a.mat_hold_qty});this.selectMat_list=e,this.selectedSecondIndex=t.rowIndex,this.showMatStockModal=!0},async matData(t){let e=0,a=[];this.secondRowData[this.selectedSecondIndex].mat_LOTs=[];for(let o of t)e+=parseInt(o.mat_hold_qty),this.secondRowData[this.selectedSecondIndex].mat_LOTs.push({mat_code:o.mat_code,mat_LOT:o.mat_LOT,mat_hold_qty:o.mat_hold_qty}),a.push({prod_code:this.secondRowData[this.selectedSecondIndex].prod_code,mat_code:o.mat_code,mat_LOT:o.mat_LOT,hold_quantity:o.mat_hold_qty});this.matTempHoldDataList.concat(a),this.matTempHoldDataList=this.matTempHoldDataList.filter((t=>!a.some((e=>e.prod_code===t.prod_code&&e.mat_LOT===t.mat_LOT)))),this.matTempHoldDataList=this.matTempHoldDataList.concat(a),this.secondRowData[this.selectedSecondIndex].material_input_qunatity=e,this.secondRowData=[...this.secondRowData]},async addPlanOrder(){let t=await m.A.get(`/api/work/order/orderCheck/${this.formData.product_order_code}`).catch((t=>(console.error(t),u().fire({title:"실패",text:"생산 계획 코드 조회 중 오류가 발생했습니다.",icon:"error",confirmButtonText:"확인"}),1)));if(t.data.check>0)return void u().fire({title:"실패",text:"이미 등록된 생산 계획 코드입니다.",icon:"error",confirmButtonText:"확인"});if(this.insertVaildation()>0)return;let e={product_order_code:this.formData.product_order_code,plan_code:this.formData.plan_code,product_order_name:this.formData.product_order_name,employee_code:this.formData.employee_code,start_date:this.formData.start_date,end_date:this.formData.end_date,note:this.formData.note},a=await m.A.post("/api/work/order/insert",{orderData:e,orderDetailDataList:this.rowData,matHoldDataList:this.secondRowData}).catch((t=>{console.error(t),u().fire({title:"실패",text:"생산 지시 등록 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})}));a.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 등록되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm(),this.autoOrder_Code()):u().fire({title:"경고",text:"생산 지시 등록 과정에서 오류가 발생했습니다.",icon:"warning",confirmButtonText:"확인"})},async updateProductOrder(){if(this.editMode,this.insertVaildation()>0)return;for(let e of this.secondRowData)if(!Array.isArray(e.mat_LOTs))return void u().fire({title:"실패",text:"자재 확보를 먼저 하신 후 수정바랍니다.",icon:"error",confirmButtonText:"확인"});let t=await m.A.put("/api/work/order/update",{orderData:this.formData,workDetailList:this.rowData,matHoldDataList:this.secondRowData}).catch((t=>console.error(t)));t.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 수정되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm(),this.autoOrder_Code()):0===t.data[0].check?u().fire({title:"경고",text:"등록되어 있지 않은 정보입니다.",icon:"warning",confirmButtonText:"확인"}):u().fire({title:"실패",text:"생산 지시 수정 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})},async deleteProductOrder(){if(""==this.formData&&u().fire({title:"알림",text:"생산 계획이 존재 하지 않습니다.",icon:"question",confirmButtonText:"확인"}),this.anotherVaildation()>0)return;const t=u().mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1}),e=await t.fire({title:"알림",text:"정말 삭제하겠습니까?",icon:"question",confirmButtonText:"확인",cancelButtonText:"취소",showCancelButton:!0});if(!e.isConfirmed)return;let a=await m.A.delete(`/api/work/order/delete/${this.formData.product_order_code}`).catch((t=>console.error(t)));a.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 삭제되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm(),this.autoOrder_Code()):0===a.data[0].check?u().fire({title:"경고",text:"등록되어 있지 않은 정보입니다.",icon:"warning",confirmButtonText:"확인"}):u().fire({title:"실패",text:"생산 지시 삭제 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})},prodCellClicked(t){if("editRow"===t.column.colId){const e=t.event.target;if("BUTTON"===e.tagName){const a=e.getAttribute("data-action");"delete"==a&&(t.api.applyTransaction({remove:[t.data]}),this.rowData[t.rowIndex])}}"prod_code"!=t.colDef.field&&"prod_name"!=t.colDef.field||""!==this.formData.plan_code||(this.selectedProdIndex=t.rowIndex,this.showProdModal=!0)},addNewRow(t){this.rowData.push(t),this.rowData=[...this.rowData]},addRow(){""==this.formData.plan_code?(this.rowData.push({orders_code:"",prod_name:"",plan_quantity:"",priority:"",order_quantity:""}),this.rowData=[...this.rowData]):u().fire({title:"실패",text:"생산 계획으로 가져온 데이터는 추가가 불가능합니다.",icon:"error",confirmButtonText:"확인"})},deleteRow(){if(""!=this.formData.plan_code)return void u().fire({title:"실패",text:"생산 계획으로 가져온 데이터는 삭제가 불가능합니다.",icon:"error",confirmButtonText:"확인"});const t=this.$refs.mainGrid.api.getSelectedNodes(),e=t.map((t=>t.data));this.rowData=this.rowData.filter((t=>!e.includes(t))),this.nonePlanOrder()},prodSelected(t){this.rowData[this.selectedProdIndex].prod_code=t.prod_code,this.rowData[this.selectedProdIndex].prod_name=t.prod_name,this.rowData[this.selectedProdIndex].priority=this.selectedProdIndex+1,this.rowData[this.selectedProdIndex].order_quantity=0,this.matTempHoldDataList=[],this.rowData=[...this.rowData]},onProdValueChanged(t){this.nonePlanOrder()},async nonePlanOrder(){this.secondRowData=[];for(let t of this.rowData){let e=await m.A.get("/api/work/order/matReqQtyByProd_code",{params:{prod_code:t.prod_code,quantity:t.order_quantity}}).catch((t=>console.error(t)));for(let t of e.data)this.secondRowData.push({prod_code:t.prod_code,mat_code:t.mat_code,mat_name:t.mat_name,req_material_quantity:t.req_material_quantity,mat_LOT:"",material_input_qunatity:0})}this.secondRowData=[...this.secondRowData]},insertVaildation(){if(""==this.formData.product_order_name||""==this.formData.start_date||""==this.formData.end_date)return u().fire({title:"실패",text:"모든 항목을 입력해주세요",icon:"error",confirmButtonText:"확인"}),1;if(new Date(this.formData.start_date)>new Date(this.formData.end_date))return u().fire({title:"실패",text:"종료일자가 시작일자보다 이릅니다.",icon:"error",confirmButtonText:"확인"}),1;if(this.rowData.length<=0)return u().fire({title:"실패",text:"생산 제품이 없습니다.",icon:"error",confirmButtonText:"확인"}),1;for(let t of this.rowData)if(t.plan_quantity>t.order_quantity)return u().fire({title:"실패",text:"지시량 보다 주문량이 적습니다.",icon:"error",confirmButtonText:"확인"}),1;if(!(this.secondRowData.length>0))return u().fire({title:"실패",text:"자재 홀드 데이터가 올바르지 않습니다.",icon:"error",confirmButtonText:"확인"}),1;for(let t of this.secondRowData)if(!Array.isArray(t.mat_LOTs))return u().fire({title:"실패",text:"자재 홀드 수량이 올바르지 않습니다.",icon:"error",confirmButtonText:"확인"}),1},async anotherVaildation(){}}};const it=(0,p.A)(dt,[["render",Y]]);var nt=it}}]);
//# sourceMappingURL=675.65221f72.js.map