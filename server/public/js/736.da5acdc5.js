"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[736],{6592:function(e,t,a){a.r(t),a.d(t,{default:function(){return re}});var o=a(5432),r=a(5122),l=a(641);const d={class:"text-end mb-3"},i={class:"ag-theme-alpine align-content-center"},n={class:"text-center mt-3"};function s(e,t,a,o,s,c){const m=(0,l.g2)("CModalHeader"),_=r.A,u=(0,l.g2)("AgGridVue"),h=(0,l.g2)("CModalBody"),p=(0,l.g2)("CButton"),f=(0,l.g2)("CModalFooter"),w=(0,l.g2)("CModal");return(0,l.uX)(),(0,l.Wv)(w,{visible:a.visible,onClose:c.close,backdrop:"static",alignment:"center",size:"xl",style:{"min-width":"1000px"}},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.RG)(e.$slots,"header",{},(()=>[t[0]||(t[0]=(0,l.eW)("재고 품목"))]),!0)])),_:3}),(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.bF)(_,{label:"자동계산",severity:"success",size:"large",onClick:c.autoHold},null,8,["onClick"])]),(0,l.Lk)("div",i,[(0,l.bF)(u,{style:{width:"100%",height:"100%"},class:"ag-theme-alpine",columnDefs:s.columnDefs,rowData:s.rowData,gridOptions:s.gridOptions},null,8,["columnDefs","rowData","gridOptions"])]),(0,l.Lk)("div",n,[(0,l.bF)(_,{label:"자재 확보",severity:"success",size:"large",onClick:c.matSecure},null,8,["onClick"])])])),_:1}),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.RG)(e.$slots,"footer",{},(()=>[(0,l.bF)(p,{color:"secondary",onClick:c.close},{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("닫기")]))),_:1},8,["onClick"])]),!0)])),_:3})])),_:3},8,["visible","onClose"])}a(4114),a(8111),a(116),a(1701);var c=a(7654),m=a(4335),_=a(8465),u=a.n(_),h={name:"MatStockModal",components:{AgGridVue:c.b},props:{visible:{type:Boolean,required:!0},prod_code:{type:String,required:!1},mat_code:{type:String,required:!1},mat_list:{type:Array,required:!1},mat_req_qty:{type:Number,required:!1},mat_temp_data:{type:Array,required:!1}},watch:{visible(e){e&&this.matStockList()},rowData:{handler(e){},deep:!0}},data(){return{rowData:[],original_rowData:[],mat_data:[],columnDefs:[{field:"mat_LOT",headerName:"LOT번호",flex:1},{field:"mat_code",headerName:"자재코드",flex:1},{field:"mat_name",headerName:"자재명",flex:1},{field:"store_date",headerName:"입고일자",flex:1},{field:"available_qty",headerName:"자재출고 가능 수량",flex:2},{field:"mat_hold_qty",headerName:"자재출고 수량",editable:!0,flex:2}],gridOptions:{domLayout:"autoHeight",suppressCellFocus:!0,pagination:!0,paginationPageSize:5,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1,cellStyle:{textAlign:"center"}}}}},mounted(){this.matStockList()},methods:{close(){this.$emit("close")},async matStockList(){this.rowData=[];const e=await m.A.get("/api/work/order/matQty",{params:{prod_code:this.prod_code,mat_code:this.mat_code}}).catch((e=>{console.error(e)}));let t=e.data;for(let a of t)this.rowData.push({prod_code:this.prod_code,mat_LOT:a.mat_LOT,mat_code:a.mat_code,mat_name:a.mat_name,store_date:a.store_date,available_qty:parseInt(a.available_qty),mat_hold_qty:0});this.setMatHoldData()},updateAvailableQty(e){},autoHold(){let e=this.mat_req_qty;for(let t of this.rowData){const a=parseInt(t.available_qty);if(e<=0)break;const o=Math.min(a,e);t.mat_hold_qty=o,e-=o}this.rowData=[...this.rowData]},matSecure(){this.mat_data=[];let e=0;for(let t of this.rowData){if(e+=parseInt(t.mat_hold_qty),""!=t.mat_hold_qty&&parseInt(t.mat_hold_qty)>0){if(parseInt(t.available_qty)<parseInt(t.mat_hold_qty))return void u().fire({title:"실패",text:"자재 출고 가능수량보다 자재출고 수량이 더 많습니다.",icon:"error",confirmButtonText:"확인"});this.mat_data.push({prod_code:this.prod_code,mat_code:t.mat_code,mat_LOT:t.mat_LOT,mat_hold_qty:t.mat_hold_qty})}console.log(this.mat_data)}this.mat_req_qty>e?u().fire({title:"실패",text:"자재 최소 요구량이 충족하지 않습니다.",icon:"error",confirmButtonText:"확인"}):(this.$emit("matHoldData",this.mat_data),this.close())},onRowClicked(){},setMatHoldData(){this.mat_list&&this.mat_list.length>0&&(this.rowData=this.rowData.map((e=>{const t=this.mat_list.find((t=>t.mat_LOT.toLowerCase()==e.mat_LOT.toLowerCase()&&t.mat_code.toLowerCase()==e.mat_code.toLowerCase()));return t?{...e,mat_hold_qty:t.hold_quantity}:e}))),this.mat_temp_data&&this.mat_temp_data.length>0&&(this.rowData=this.rowData.map((e=>{const t=this.mat_temp_data.find((t=>t.prod_code.toLowerCase()==e.prod_code.toLowerCase()&&t.mat_LOT.toLowerCase()==e.mat_LOT.toLowerCase()&&t.mat_code.toLowerCase()==e.mat_code.toLowerCase()));return t?{...e,mat_hold_qty:t.hold_quantity}:e}))),this.original_rowData=[...this.rowData];for(let t of this.mat_temp_data){let e=this.rowData.findIndex((e=>e.mat_code==t.mat_code&&e.mat_LOT==t.mat_LOT));-1!==e&&(this.rowData[e].available_qty=parseInt(this.rowData[e].available_qty)-parseInt(t.hold_quantity))}let e=[];for(let t of this.rowData){let a=!1;if(this.mat_temp_data&&this.mat_temp_data.length>0)for(let o of this.mat_temp_data)if(t.mat_LOT===o.mat_LOT&&t.prod_code===o.prod_code){e.push(t),a=!0;break}!a&&t.available_qty>0&&e.push(t)}this.rowData=[...e]}}},p=a(6262);const f=(0,p.A)(h,[["render",s],["__scopeId","data-v-3b311d2c"]]);var w=f,D=a(3751);const y={class:"ag-theme-alpine",style:{height:"400px",width:"100%"}},k={class:"d-flex justify-content-center me-5"},g={class:"input-group mb-3 w-50"};function b(e,t,a,o,r,d){const i=(0,l.g2)("CModalHeader"),n=(0,l.g2)("AgGridVue"),s=(0,l.g2)("CModalBody"),c=(0,l.g2)("CButton"),m=(0,l.g2)("CModalFooter"),_=(0,l.g2)("CModal");return(0,l.uX)(),(0,l.Wv)(_,{visible:a.visible,onClose:d.close,backdrop:"static",alignment:"center",size:"xl",style:{"min-width":"1000px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.RG)(e.$slots,"header",{},(()=>[t[4]||(t[4]=(0,l.eW)("생산지시 목록"))]),!0)])),_:3}),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",y,[(0,l.Lk)("div",k,[(0,l.Lk)("div",g,[(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=e=>r.searchType=e),"aria-label":"Default select example"},t[5]||(t[5]=[(0,l.Lk)("option",{value:"product_order_name",selected:""},"지시명",-1),(0,l.Lk)("option",{value:"product_order_code"},"지시 코드",-1),(0,l.Lk)("option",{value:"prod_name"},"제품명",-1)]),512),[[D.u1,r.searchType]]),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>r.searchText=e),placeholder:"검색어 입력",onKeydown:t[2]||(t[2]=(0,D.jR)(((...e)=>d.searchProudctOrder&&d.searchProudctOrder(...e)),["enter"])),class:"form-control w-50",style:{width:"30%"}},null,544),[[D.Jo,r.searchText]]),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>d.searchProudctOrder&&d.searchProudctOrder(...e)),class:"btn btn-primary"},t[6]||(t[6]=[(0,l.Lk)("i",{class:"pi pi-search"},null,-1)]))])]),(0,l.bF)(n,{style:{width:"100%",height:"100%"},class:"ag-theme-alpine",columnDefs:r.columnDefs,rowData:r.rowData,gridOptions:r.gridOptions,onRowClicked:d.onRowClicked},null,8,["columnDefs","rowData","gridOptions","onRowClicked"])])])),_:1}),(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.RG)(e.$slots,"footer",{},(()=>[(0,l.bF)(c,{color:"secondary",onClick:d.close},{default:(0,l.k6)((()=>t[7]||(t[7]=[(0,l.eW)("닫기")]))),_:1},8,["onClick"])]),!0)])),_:3})])),_:3},8,["visible","onClose"])}var x={name:"PlanOrderModal",components:{AgGridVue:c.b},props:{visible:{type:Boolean,required:!0}},watch:{visible(e){e&&this.planOrderList()}},data(){return{rowData:[],searchType:"product_order_name",searchText:"",columnDefs:[{field:"product_order_code",headerName:"생산지시코드",flex:1},{field:"product_order_name",headerName:"생산지시명",flex:2},{field:"start_date",headerName:"시작일",flex:1},{field:"end_date",headerName:"종료일",flex:1},{field:"prod_name",headerName:"제품명",flex:3},{field:"finish_status",headerName:"상태",flex:1,valueFormatter:e=>"WS1"===e.value?"지시 등록":"WS2"===e.value?"생산중":"WS3"===e.value?"생산 완료":"WS4"==e.value?"폐기 처분":void 0,cellStyle:e=>"WS1"===e.value?{textAlign:"center",fontWeight:"bold",color:"#6c757d"}:"WS2"==e.value?{textAlign:"center",fontWeight:"bold",color:"#fd7e14"}:"WS3"==e.value||"WS4"==e.value?{textAlign:"center",fontWeight:"bold",color:"#28a745"}:void 0}],gridOptions:{domLayout:"autoHeight",suppressCellFocus:!0,pagination:!0,paginationPageSize:5,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1,cellStyle:{textAlign:"center"}}}}},mounted(){this.planOrderList()},methods:{close(){this.$emit("close")},planOrderList(){m.A.get("/api/work/order/list").then((e=>{this.rowData=e.data})).catch((e=>{console.error(e)}))},async searchProudctOrder(){await m.A.get("/api/work/order/list",{params:{type:this.searchType,keyword:this.searchText}}).then((e=>{this.rowData=e.data})).catch((e=>console.error(e)))},onRowClicked(e){"WS3"!==e.data.finish_status?"WS4"!==e.data.finish_status?(this.$emit("selectPlanOrder",e.data),this.close()):u().fire({title:"실패",text:"폐기된 지시입니다.",icon:"error",confirmButtonText:"확인"}):u().fire({title:"실패",text:"이미 생산이 완료된 지시입니다.",icon:"error",confirmButtonText:"확인"})}}};const L=(0,p.A)(x,[["render",b],["__scopeId","data-v-47657840"]]);var v=L,q=a(825),C=a(3889),O=a(6704),T=a(109),S=a(8235);const F={class:"card border-0",style:{height:"calc(55vh - 5.5rem)"}},A={class:"text-end mt-3 mb-3"},P={class:"mb-3"},M={class:"row mb-4"},R={class:"col-4"},V={class:"col-4"},B={class:"col-4"},H={class:"row mb-4"},I={class:"col-4"},W={class:"col-4"},N={class:"row mb-4"},z={class:"col-4"},$={class:"col-4"},G={class:"col-4"},U={class:"row"},Q={class:"col"},j={class:"card border-0",style:{height:"calc(45vh - 4.5rem)"}},X={class:"row justify-content-end mb-3"},E={class:"col"},K={class:"ag-wrapper",style:{border:"none"}},J={class:"col"},Y={class:"card border-0",style:{height:"calc(45vh - 4.5rem)"}},Z={class:"ag-wrapper",style:{border:"none"}};function ee(e,t,a,d,i,n){const s=r.A,c=S.A,m=T.A,_=O.A,u=C.A,h=(0,l.g2)("ag-grid-vue"),p=q.A,f=v,D=w,y=o.A;return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",F,[t[20]||(t[20]=(0,l.Lk)("h3",null,"생산 지시 관리",-1)),t[21]||(t[21]=(0,l.Lk)("div",{class:"heading-with-line"},[(0,l.Lk)("h5",{class:"m-0 me-3"},"등록 | 수정 | 삭제")],-1)),(0,l.Lk)("div",A,[(0,l.bF)(s,{label:"계획목록",severity:"success",class:"me-3",onClick:n.planList},null,8,["onClick"]),(0,l.bF)(s,{label:"지시목록",severity:"info",class:"me-3",onClick:n.planOrderList},null,8,["onClick"]),(0,l.bF)(s,{label:"등록",severity:"help",class:"me-3",onClick:n.addPlanOrder},null,8,["onClick"]),(0,l.bF)(s,{label:"수정",severity:"danger",class:"me-3",onClick:n.updateProductOrder},null,8,["onClick"]),(0,l.bF)(s,{label:"삭제",severity:"danger",class:"",onClick:n.deleteProductOrder},null,8,["onClick"])]),(0,l.Lk)("div",P,[(0,l.Lk)("div",M,[(0,l.Lk)("div",R,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[12]||(t[12]=[(0,l.eW)(" 생산 지시 코드 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.product_order_code,"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.product_order_code=e),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",V,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[13]||(t[13]=[(0,l.eW)(" 계획 코드 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.plan_code,"onUpdate:modelValue":t[1]||(t[1]=e=>i.formData.plan_code=e),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",B,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[14]||(t[14]=[(0,l.eW)(" 계획명 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.plan_name,"onUpdate:modelValue":t[2]||(t[2]=e=>i.formData.plan_name=e),size:"large",placeholder:"",readOnly:""},null,8,["modelValue"])])),_:1})])]),(0,l.Lk)("div",H,[(0,l.Lk)("div",I,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[15]||(t[15]=[(0,l.eW)(" 담당자 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.employee_name,"onUpdate:modelValue":t[3]||(t[3]=e=>i.formData.employee_name=e),size:"large",placeholder:""},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",W,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.eW)(" 생산 지시명 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.product_order_name,"onUpdate:modelValue":t[4]||(t[4]=e=>i.formData.product_order_name=e),size:"large",placeholder:"(입력)"},null,8,["modelValue"])])),_:1})])]),(0,l.Lk)("div",N,[(0,l.Lk)("div",z,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[17]||(t[17]=[(0,l.eW)(" 시작일자 ")]))),_:1}),(0,l.bF)(u,{modelValue:i.formData.start_date,"onUpdate:modelValue":t[5]||(t[5]=e=>i.formData.start_date=e),size:"large",dateFormat:"yy/mm/dd",placeholder:"(입력)",showIcon:"",iconDisplay:"input"},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",$,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.eW)(" 종료일자 ")]))),_:1}),(0,l.bF)(u,{modelValue:i.formData.end_date,"onUpdate:modelValue":t[6]||(t[6]=e=>i.formData.end_date=e),size:"large",dateFormat:"yy/mm/dd",placeholder:"(입력)",showIcon:"",iconDisplay:"input"},null,8,["modelValue"])])),_:1})]),(0,l.Lk)("div",G,[(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[19]||(t[19]=[(0,l.eW)(" 비고 ")]))),_:1}),(0,l.bF)(m,{modelValue:i.formData.note,"onUpdate:modelValue":t[7]||(t[7]=e=>i.formData.note=e),size:"large",placeholder:""},null,8,["modelValue"])])),_:1})])]),(0,l.bF)(s,{label:"초기화",severity:"danger",class:"me-5",size:"large",onClick:n.clearForm},null,8,["onClick"])])]),(0,l.Lk)("div",U,[(0,l.Lk)("div",Q,[(0,l.Lk)("div",j,[t[22]||(t[22]=(0,l.Lk)("div",{class:"heading-with-line mb-2"},[(0,l.Lk)("h5",{class:"m-0 me-3"},"생산 제품 목록")],-1)),(0,l.Lk)("div",X,[(0,l.Lk)("div",E,[(0,l.bF)(s,{label:"행추가",severity:"success me-2",onClick:n.addRow},null,8,["onClick"]),(0,l.bF)(s,{label:"행삭제",severity:"danger",onClick:n.deleteRow},null,8,["onClick"])])]),(0,l.Lk)("div",K,[(0,l.bF)(h,{ref:"mainGrid",class:"ag-theme-alpine custom-grid-theme",columnDefs:i.prodListDefs,rowData:i.rowData,gridOptions:i.gridOptions,onCellClicked:n.prodCellClicked,onCellValueChanged:n.onProdValueChanged},null,8,["columnDefs","rowData","gridOptions","onCellClicked","onCellValueChanged"])])])]),(0,l.Lk)("div",J,[(0,l.Lk)("div",Y,[t[23]||(t[23]=(0,l.Lk)("div",{class:"heading-with-line mb-3"},[(0,l.Lk)("h5",{class:"m-0 me-3"},"자재 홀드")],-1)),(0,l.Lk)("div",Z,[(0,l.bF)(h,{class:"ag-theme-alpine custom-grid-theme",columnDefs:i.matHoldListDefs,rowData:i.secondRowData,gridOptions:i.gridOptions,onRowClicked:n.matRowClicked},null,8,["columnDefs","rowData","gridOptions","onRowClicked"])])])])]),(0,l.bF)(p,{visible:i.showPlanModal,onClose:t[8]||(t[8]=e=>i.showPlanModal=!1),onSelectPlan:n.planSelected},null,8,["visible","onSelectPlan"]),(0,l.bF)(f,{visible:i.showPlanOrderModal,onClose:t[9]||(t[9]=e=>i.showPlanOrderModal=!1),onSelectPlanOrder:n.planOrderSelected},null,8,["visible","onSelectPlanOrder"]),(0,l.bF)(D,{visible:i.showMatStockModal,onClose:t[10]||(t[10]=e=>i.showMatStockModal=!1),prod_code:i.selectProd_code,mat_code:i.selectMat_code,mat_list:i.selectMat_list,mat_req_qty:i.selectMat_req_qty,mat_temp_data:i.matTempHoldDataList,onMatHoldData:n.matData},null,8,["visible","prod_code","mat_code","mat_list","mat_req_qty","mat_temp_data","onMatHoldData"]),(0,l.bF)(y,{visible:i.showProdModal,onClose:t[11]||(t[11]=e=>i.showProdModal=!1),onSelectProd:n.prodSelected},null,8,["visible","onSelectProd"])],64)}a(2489);var te=a(4783),ae={components:{AgGridVue:c.b,PlanModal:q.A,PlanOrderModal:v,MatStock:w,ProdModal:o.A},data(){return{showPlanModal:!1,showPlanOrderModal:!1,showMatStockModal:!1,showProdModal:!1,selectProd_code:null,selectMat_code:null,selectMat_list:null,selectMat_req_qty:null,selectedProdIndex:null,selectedSecondIndex:null,editMode:!1,matTempHoldDataList:[],matHoldDataList:[],formData:{product_order_code:"",employee_code:(0,te.k)().id,employee_name:(0,te.k)().empName,product_order_name:"",plan_code:"",plan_name:"",start_date:"",end_date:"",note:""},rowData:[],secondRowData:[],prodListDefs:[{checkboxSelection:!0,width:50},{field:"prod_code",headerName:"제품코드",flex:1.5,cellStyle:e=>e.data.prod_code?{textAlign:"center"}:{textAlign:"center",backgroundColor:"#d9f2ff !important"}},{field:"prod_name",headerName:"제품명",flex:2.5,cellStyle:e=>e.data.prod_code?{textAlign:"center"}:{textAlign:"center",backgroundColor:"#d9f2ff !important"}},{field:"plan_quantity",headerName:"주문수량",flex:1.5,cellStyle:{textAlign:"center"}},{field:"priority",headerName:"우선순위",flex:1.5,cellStyle:{textAlign:"center"}},{field:"order_quantity",headerName:"지시량",flex:1,editable:!0,cellStyle:e=>e.data.prod_code?{textAlign:"center",backgroundColor:"#d9f2ff !important"}:{textAlign:"center"}}],matHoldListDefs:[{field:"prod_code",headerName:"제품코드",flex:2,cellStyle:{textAlign:"center"}},{field:"mat_code",headerName:"자재코드",flex:2,cellStyle:{textAlign:"center"}},{field:"mat_name",headerName:"자재명",flex:2.5,cellStyle:{textAlign:"center"}},{field:"req_material_quantity",headerName:"요구량",flex:1.5,cellStyle:{textAlign:"center"}},{field:"material_input_qunatity",headerName:"투입량",flex:1,cellStyle:{textAlign:"center"}}],gridOptions:{domLayout:"autoHeight",singleClickEdit:!0,suppressRowClickSelection:!0,paginationPageSize:5,paginationPageSizeSelector:!1,defaultColDef:{suppressMovable:!0,resizable:!1,sortable:!1}}}},watch(){},mounted(){this.clearForm()},methods:{clearForm(){this.formData={product_order_code:this.formData.product_order_code,employee_code:(0,te.k)().id,employee_name:(0,te.k)().empName,product_order_name:"",plan_code:"",plan_name:"",start_date:"",end_date:"",note:""},this.rowData=[],this.secondRowData=[],this.matTempHoldDataList=[],this.matHoldDataList=[],this.autoOrder_Code()},planList(){this.showPlanModal=!0},planOrderList(){this.showPlanOrderModal=!0},matStockList(){},async autoOrder_Code(){try{const e=await m.A.get("/api/work/order/orderAutoCode");this.formData.product_order_code=e.data[0].product_order_code}catch(e){console.error(e)}},async planSelected(e){this.clearForm(),this.formData.plan_code=e.plan_code,this.formData.plan_name=e.plan_name,this.formData.start_date=e.start_date,this.formData.end_date=e.end_date,await m.A.get(`/api/work/plan/planDetailList/${e.plan_code}`,{}).then((e=>{this.rowData=[];const t=e.data;let a=1;for(let o of t)this.rowData.push({prod_code:o.prod_code,prod_name:o.prod_name,plan_quantity:o.currentPlanQty,priority:a,order_quantity:o.currentPlanQty}),a++})).catch((e=>console.error(e))),await m.A.get(`/api/work/order/matReqQty/${e.plan_code}`,{}).then((e=>{this.secondRowData=[];const t=e.data;for(let a of t)this.secondRowData.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_name:a.mat_name,req_material_quantity:a.req_material_quantity,material_input_qunatity:a.material_input_qunatity})})).catch((e=>{console.error(e)})),this.rowData=[...this.rowData]},async planOrderSelected(e){this.clearForm();let t=await m.A.get(`/api/work/order/productOrder/${e.product_order_code}`,{}).catch((e=>console.error(e)));const a=t.data;this.formData.product_order_code=a.product_order_code,this.formData.product_order_name=a.product_order_name,this.formData.employee_code=a.employee_code,this.formData.plan_code=a.plan_code,this.formData.plan_name=a.plan_name,this.formData.start_date=a.start_date,this.formData.end_date=a.end_date,this.formData.note=a.note,t=await m.A.get(`/api/work/order/workDetail/${e.product_order_code}`).catch((e=>console.error(e)));const o=t.data;for(let r of o){this.rowData.push({product_order_detail_code:r.product_order_detail_code,prod_code:r.prod_code,prod_name:r.prod_name,plan_quantity:r.plan_quantity,priority:r.priority,order_quantity:r.order_quantity}),t=await m.A.get(`/api/work/order/loadMatQty/${r.product_order_detail_code}`).catch((e=>console.error(e)));const e=t.data;for(let a of e){this.secondRowData.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_name:a.mat_name,req_material_quantity:a.req_material_quantity,material_input_qunatity:a.hold_quantity}),t=await m.A.get("/api/work/order/loadMat",{params:{product_order_detail_code:r.product_order_detail_code,mat_code:a.mat_code}}).catch((e=>console.error(e)));const e=t.data;for(let t of e)this.matHoldDataList.push({prod_code:t.prod_code,mat_code:a.mat_code,mat_LOT:t.mat_LOT,mat_hold_qty:t.hold_quantity})}}this.rowData=[...this.rowData],this.secondRowData=[...this.secondRowData]},matRowClicked(e){this.selectProd_code=e.data.prod_code,this.selectMat_code=e.data.mat_code,this.selectMat_req_qty=e.data.req_material_quantity;let t=[];for(let a of this.matHoldDataList)a.mat_code==e.data.mat_code&&a.prod_code==e.data.prod_code&&t.push({prod_code:a.prod_code,mat_code:a.mat_code,mat_LOT:a.mat_LOT,hold_quantity:a.mat_hold_qty});this.selectMat_list=t,this.selectedSecondIndex=e.rowIndex,this.showMatStockModal=!0},async matData(e){let t=0,a=[];this.secondRowData[this.selectedSecondIndex].mat_LOTs=[];for(let o of e)t+=parseInt(o.mat_hold_qty),this.secondRowData[this.selectedSecondIndex].mat_LOTs.push({mat_code:o.mat_code,mat_LOT:o.mat_LOT,mat_hold_qty:o.mat_hold_qty}),a.push({prod_code:this.secondRowData[this.selectedSecondIndex].prod_code,mat_code:o.mat_code,mat_LOT:o.mat_LOT,hold_quantity:o.mat_hold_qty});this.matTempHoldDataList.concat(a),this.matTempHoldDataList=this.matTempHoldDataList.filter((e=>!a.some((t=>t.prod_code===e.prod_code&&t.mat_LOT===e.mat_LOT)))),this.matTempHoldDataList=this.matTempHoldDataList.concat(a),this.secondRowData[this.selectedSecondIndex].material_input_qunatity=t,this.secondRowData=[...this.secondRowData]},addRow(){""==this.formData.plan_code?(this.rowData.push({orders_code:"",prod_name:"",plan_quantity:"",priority:"",order_quantity:""}),this.rowData=[...this.rowData]):u().fire({title:"실패",text:"생산 계획으로 가져온 데이터는 추가가 불가능합니다.",icon:"error",confirmButtonText:"확인"})},deleteRow(){if(""!=this.formData.plan_code)return void u().fire({title:"실패",text:"생산 계획으로 가져온 데이터는 삭제가 불가능합니다.",icon:"error",confirmButtonText:"확인"});const e=this.$refs.mainGrid.api.getSelectedNodes(),t=e.map((e=>e.data));this.rowData=this.rowData.filter((e=>!t.includes(e))),this.nonePlanOrder()},async addPlanOrder(){let e=await m.A.get(`/api/work/order/orderCheck/${this.formData.product_order_code}`).catch((e=>(console.error(e),u().fire({title:"실패",text:"생산 계획 코드 조회 중 오류가 발생했습니다.",icon:"error",confirmButtonText:"확인"}),1)));if(e.data.check>0)return void u().fire({title:"실패",text:"이미 등록된 생산 계획 코드입니다.",icon:"error",confirmButtonText:"확인"});if(this.insertVaildation()>0)return;let t={product_order_code:this.formData.product_order_code,plan_code:this.formData.plan_code,product_order_name:this.formData.product_order_name,employee_code:this.formData.employee_code,start_date:this.formData.start_date,end_date:this.formData.end_date,note:this.formData.note},a=await m.A.post("/api/work/order/insert",{orderData:t,orderDetailDataList:this.rowData,matHoldDataList:this.secondRowData}).catch((e=>{console.error(e),u().fire({title:"실패",text:"생산 지시 등록 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})}));a.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 등록되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm()):u().fire({title:"경고",text:"생산 지시 등록 과정에서 오류가 발생했습니다.",icon:"warning",confirmButtonText:"확인"})},async updateProductOrder(){if(this.editMode,this.insertVaildation()>0)return;for(let t of this.secondRowData)if(!Array.isArray(t.mat_LOTs))return void u().fire({title:"실패",text:"자재 확보를 먼저 하신 후 수정바랍니다.",icon:"error",confirmButtonText:"확인"});let e=await m.A.put("/api/work/order/update",{orderData:this.formData,workDetailList:this.rowData,matHoldDataList:this.secondRowData}).catch((e=>console.error(e)));e.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 수정되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm()):0===e.data[0].check?u().fire({title:"경고",text:"등록되어 있지 않은 정보입니다.",icon:"warning",confirmButtonText:"확인"}):u().fire({title:"실패",text:"생산 지시 수정 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})},async deleteProductOrder(){if(""==this.formData&&u().fire({title:"알림",text:"생산 계획이 존재 하지 않습니다.",icon:"question",confirmButtonText:"확인"}),this.anotherVaildation()>0)return;const e=u().mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1}),t=await e.fire({title:"알림",text:"정말 삭제하겠습니까?",icon:"question",confirmButtonText:"확인",cancelButtonText:"취소",showCancelButton:!0});if(!t.isConfirmed)return;let a=await m.A.delete(`/api/work/order/delete/${this.formData.product_order_code}`).catch((e=>console.error(e)));a.data.affectedRows>0?(u().fire({title:"성공",text:"생산 지시가 정상적으로 삭제되었습니다.",icon:"success",confirmButtonText:"확인"}),this.clearForm()):0===a.data[0].check?u().fire({title:"경고",text:"등록되어 있지 않은 정보입니다.",icon:"warning",confirmButtonText:"확인"}):u().fire({title:"실패",text:"생산 지시 삭제 중 오류가 발생되었습니다.",icon:"error",confirmButtonText:"확인"})},prodCellClicked(e){"prod_code"!=e.colDef.field&&"prod_name"!=e.colDef.field||""!==this.formData.plan_code||(this.selectedProdIndex=e.rowIndex,this.showProdModal=!0)},prodSelected(e){this.rowData[this.selectedProdIndex].prod_code=e.prod_code,this.rowData[this.selectedProdIndex].prod_name=e.prod_name,this.rowData[this.selectedProdIndex].priority=this.selectedProdIndex+1,this.rowData[this.selectedProdIndex].order_quantity=0,this.matTempHoldDataList=[],this.rowData=[...this.rowData]},onProdValueChanged(e){this.nonePlanOrder()},async nonePlanOrder(){this.secondRowData=[];for(let e of this.rowData){let t=await m.A.get("/api/work/order/matReqQtyByProd_code",{params:{prod_code:e.prod_code,quantity:e.order_quantity}}).catch((e=>console.error(e)));for(let e of t.data)this.secondRowData.push({prod_code:e.prod_code,mat_code:e.mat_code,mat_name:e.mat_name,req_material_quantity:e.req_material_quantity,mat_LOT:"",material_input_qunatity:0})}this.secondRowData=[...this.secondRowData]},insertVaildation(){if(""==this.formData.product_order_name||""==this.formData.start_date||""==this.formData.end_date)return u().fire({title:"실패",text:"모든 항목을 입력해주세요",icon:"error",confirmButtonText:"확인"}),1;if(new Date(this.formData.start_date)>new Date(this.formData.end_date))return u().fire({title:"실패",text:"종료일자가 시작일자보다 이릅니다.",icon:"error",confirmButtonText:"확인"}),1;if(this.rowData.length<=0)return u().fire({title:"실패",text:"생산 제품이 없습니다.",icon:"error",confirmButtonText:"확인"}),1;for(let e of this.rowData)if(e.plan_quantity>e.order_quantity)return u().fire({title:"실패",text:"지시량 보다 주문량이 적습니다.",icon:"error",confirmButtonText:"확인"}),1;if(!(this.secondRowData.length>0))return u().fire({title:"실패",text:"자재 홀드 데이터가 올바르지 않습니다.",icon:"error",confirmButtonText:"확인"}),1;for(let e of this.secondRowData)if(!Array.isArray(e.mat_LOTs))return u().fire({title:"실패",text:"자재 홀드 수량이 올바르지 않습니다.",icon:"error",confirmButtonText:"확인"}),1},async anotherVaildation(){}}};const oe=(0,p.A)(ae,[["render",ee]]);var re=oe}}]);
//# sourceMappingURL=736.da5acdc5.js.map